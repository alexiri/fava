{% extends "_layout.html" %}
{% set active_page = 'editor' %}
{% set file_path = request.args.get('file_path', ledger.fava_options['default-file'] or ledger.beancount_file_path) %}

{% block content %}
  <form id="source-editor-form" class="source-form">
    <div class="fieldset">
      <ul class="dropdown">
        <li>{{ _('File') }}&nbsp;▾
          <ul>
            {% for source_file in ledger.file.list_sources() %}
              <li {% if source_file == file_path %} class="selected"{% endif %}>
                <a href="{{ url_for_source(file_path=source_file) }}">{{ source_file }}</a>
              </li>
            {% endfor %}
          </ul>
        </li>
        <li>{{ _('Edit') }}&nbsp;▾
          <ul>
            <li>
              <button data-command="favaFormat" type="button" class="link">{{ _('Align Amounts') }}</button>
              <span>
                <kbd>Ctrl</kbd>/<kbd>Cmd</kbd>+<kbd>d</kbd>
              </span>
            </li>
            <li>
              <button data-command="favaToggleComment" type="button" class="link">{{ _('Toggle Comment (selection)') }}</button>
              <span>
                <kbd>Ctrl</kbd>/<kbd>Cmd</kbd>+<kbd>y</kbd>
              </span>
            </li>
            <li>
              <button data-command="unfoldAll" type="button" class="link">{{ _('Open all folds') }}</button>
            </li>
            <li>
              <button data-command="foldAll" type="button" class="link">{{ _('Close all folds') }}</button>
            </li>
          </ul>
        </li>
      </ul>
      <button id="source-editor-submit" type="button" disabled data-command="favaSave" data-filename="{{ file_path }}" data-progress-content="{{ _('Saving...') }}" title="{{ _('Save') }} (Ctrl/Cmd+s)"(>{{ _('Save') }}</button>
      <div class="buttons-right">
        <button id="source-editor-top" type="button" data-command="goDocStart" title="{{ _('Scroll to top') }} (Ctrl/Cmd+Home)">
          <svg width="12" height="16" viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.048 1.845a.508.508 0 0 1-.32-.105c-.091-.07-.136-.154-.136-.25V.78c0-.095.045-.178.135-.249a.508.508 0 0 1 .321-.105h10.043c.124 0 .23.035.321.105.09.07.136.154.136.25v.71c0 .095-.045.178-.136.249a.508.508 0 0 1-.32.105"></path>
            <path d="M.687 7.973c-.09.087-.122.16-.093.22.028.06.104.09.228.09h10.5c.123 0 .2-.03.228-.09.029-.06-.002-.133-.093-.22L6.393 3.09A.458.458 0 0 0 6.257 3h-.37a.626.626 0 0 0-.136.09"></path>
            <path d="M.687 14.973c-.09.087-.122.16-.093.22.028.06.104.09.228.09h10.5c.123 0 .2-.03.228-.09.029-.06-.002-.133-.093-.22L6.393 10.09A.458.458 0 0 0 6.257 10h-.37a.626.626 0 0 0-.136.09"></path>
          </svg>
        </button>
        <button id="source-editor-bottom" type="button" data-command="goDocEnd" title="{{ _('Scroll to bottom') }} (Ctrl/Cmd+End)">
          <svg width="12" height="16" viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg">
            <path class="first-triangle" d="M1.048 14.155a.508.508 0 0 0-.32.105c-.091.07-.136.154-.136.25v.71c0 .095.045.178.135.249.09.07.197.105.321.105h10.043c.124 0 .23-.035.321-.105.09-.07.136-.154.136-.25v-.71c0-.095-.045-.178-.136-.249a.508.508 0 0 0-.32-.105"></path>
            <path class="second-triangle" d="M.687 8.027c-.09-.087-.122-.16-.093-.22.028-.06.104-.09.228-.09h10.5c.123 0 .2.03.228.09.029.06-.002.133-.093.22L6.393 12.91a.458.458 0 0 1-.136.089h-.37a.626.626 0 0 1-.136-.09"></path>
            <path class="third-triangle" d="M.687 1.027C.597.94.565.867.594.807c.028-.06.104-.09.228-.09h10.5c.123 0 .2.03.228.09.029.06-.002.133-.093.22L6.393 5.91A.458.458 0 0 1 6.257 6h-.37a.626.626 0 0 1-.136-.09"></path>
          </svg>
        </button>
      </div>
    </div>
    <div class="source-editor-wrapper">
      {% set source, sha256sum = ledger.file.get_source(file_path) %}
      <textarea id="source-editor" name="source" autofocus spellcheck="false" data-sha256sum="{{ sha256sum }}">{{ source or '' }}</textarea>
    </div>
  </form>
{% endblock %}
